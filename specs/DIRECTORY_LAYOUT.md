# Directory Layout (example stack: Next.js + Spring Boot)

## Root tree
```
<repo>/
├── api/
├── ui/
├── db/
├── docs/
├── e2e/
├── ai/
├── .claude/
├── Makefile
├── start-backend.sh
├── test-video-detection.sh
├── package.json (dev dependency: shadcn)
├── package-lock.json
└── node_modules/ (generated by `make install`)
```

## `api/` (Spring Boot backend)
- `pom.xml` — single Maven file with all Spring Boot, Jasypt, metadata, and Testcontainers dependencies (`api/pom.xml`).
- `src/main/java/com/picturemodel/` — packages:
  - `MediaViewerApplication.java` (entry point).
  - `api/controller/` — DriveController, ImageController, FileController, TagController, CrawlerController, SystemController (see `docs/plan-mode-driver.md` Turn 4). The controllers map to the endpoints listed in `docs/tech-stack.md` and `docs/schemas/`.
  - `api/dto/request` & `api/dto/response` — DTOs matching JSON schemas.
  - `config/` — AsyncConfig, CorsConfig, JacksonConfig, JasyptConfig, JpaConfig, WebSocketConfig.
  - `domain/` — `entity/`, `enums/`, `repository/` (Drive, Image, ImageMetadata, Tag, CrawlJob plus enums like DriveType, MetadataSource).
  - `infrastructure/filesystem/` — FileSystemProvider interface and Local/SMB/SFTP/FTP implementations, factory, media constants.
  - `service/` — CredentialEncryptionService, DriveService, CrawlerService, ExifExtractorService, ImageService, TagService, ThumbnailService, VideoMetadataExtractorService, VideoThumbnailService, WebSocketEventService.
- `src/main/resources/` — `application.yml` (with `spring.jpa.open-in-view: true`, CORS whitelists, app thumbnail configuration), `application-dev.yml` (H2, Jasypt dev password, logs), `application-prod.yml` (PostgreSQL, Jasypt production). These resource files are referenced by `Makefile` and `start-backend.sh`.
- `data/` — H2 database file directory (populated when running locally per `application-dev.yml`).
- `thumbnails/` — directory pointed to by `app.thumbnails.base-path` (`./thumbnails`) for generated media previews.

## `ui/` (Next.js frontend)
- `package.json` / `package-lock.json` — dependencies include Next.js 16.1.6, React 19.2.3, Tailwind v4, shadcn, @tanstack/react-query, Zustand, react-hook-form, Zod, SokJS/STOMP, Vidstack, Lucide, etc.
- `next.config.ts` — rewrites `/api` to `http://localhost:8080/api` and sets `transpilePackages: ['@vidstack/react']` for Turbopack compatibility.
- `src/app/` — App Router layout and pages:
  - `layout.tsx` wires `QueryClientProvider`, `ReactQueryDevtools`, Tailwind globals.
  - `globals.css` imports Tailwind, tw-animate-css, shadcn CSS, and defines theme tokens (per `docs/rebuild-guide.md` Turn 1).
  - Pages: `page.tsx` (dashboard), `browse/page.tsx`, `browse/[id]/page.tsx`, `images/page.tsx`, `images/[id]/page.tsx` (video player), `storage/page.tsx`, `tags/page.tsx`, `settings/page.tsx`.
- `src/components/` — reusable pieces (MainLayout, Sidebar, DriveCard, ImageGrid, ImageThumbnail, FilterSidebar, SearchBar, Pagination, TagPill, AddDriveDialog, VideoPlayer). Each uses shadcn primitives from `components/ui/`.
- `src/hooks/` — hooks for API actions and WebSocket (`use-drives`, `use-images`, `use-tags`, `use-crawler`, `use-websocket`, `use-debounce`).
- `src/lib/` — `api-client.ts` (fetch wrapper, base URL plus QueryClient), `utils.ts` (cn, formatDate, formatBytes/time/duration), `media-utils.ts` (isVideoMimeType). 
- `src/store/` — Zustand search store with page resets per filter changes (`use-search-store.ts`).
- `src/types/` — interfaces mirroring backend DTOs (`ui/src/types/api.ts`).
- `public/` — static assets including `favicon.ico`.
- `docs/file-map.md` describes the structure of the UI stack and is referenced by onboarding and automation.

## Supporting directories & files
- `db/` — `schema.sql` (PostgreSQL-compatible DDL derived from the JPA entities and referenced in `docs/rebuild-guide.md` Turn 8). This file is critical for Docker setups and Postgres deployments.
- `docs/` — architectural guides: `docs/rebuild-guide.md` (workflow), `docs/plan-mode-driver.md` (pre-made decisions), `docs/tech-stack.md` (stack tables), `docs/ENGINEERING_DESIGN_SPEC.md` (system context, API spec, performance/security), `docs/schemas/` (JSON request/response validators), `docs/PRD.md` (requirements), `docs/shadcn.md`, and `docs/article-skills.md`.
- `e2e/` — HTTP workspaces for automated smoke tests (drive, crawler, files, image/tag operations). Each `.http` file defines `@baseUrl` and chained requests (per Turn 8 expectations), e.g., `e2e/drive-create.http`.
- `ai/` — `ai/context` (project contexts, backend/frontend breakdowns) and `ai/agentic-pipeline/turns` (per-turn manifests, session_context, pull_request, ADR). The `turns_index.csv` summarizes the executed tasks and branches.
- `.claude/skills/sql` — skill used to regenerate `db/schema.sql`; its header is referenced in the schema file.
- `Makefile`, `start-backend.sh`, `test-video-detection.sh` — helper scripts for running, building, and verifying playback (referenced in `spec/COMMANDS.md`).
